<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:composite="http://xmlns.jcp.org/jsf/composite" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:p="http://primefaces.org/ui">
	<composite:interface>
	</composite:interface>
	<composite:implementation>
		<h:panelGroup>
			<div class="row">
				<div class="col-sm-12">
					<div class="box box-color box-bordered lightgrey">
						<div class="box-title">
							<h3>
								<i class="fa fa-plug"></i>
								<h:outputText value="#{msgs[NavigationForm.workflowPlugin.title]}" />
							</h3>
						</div>
						<div class="box-content">
							<h:panelGroup
								rendered="#{!LoginForm.hasRole('Plugin_workflow_closestep')}">
								<h:outputText
									styleClass="alert alert-danger alert-dismissable margin-bottom-10 margin-top-10"
									value="#{msgs.plugin_administration_missingPermission} Plugin_workflow_closestep"></h:outputText>
							</h:panelGroup>
							<h:panelGroup id="actionform" styleClass="col-sm-12"
								rendered="#{LoginForm.hasRole('Plugin_workflow_closestep')}">
								<div class="row">
									<h3>File Upload for process ids</h3>
									<h:form id="fileUploadForm" prependId="false" enctype="multipart/form-data">
										<table>
											<tr>
												<td>
													<h:outputLabel for="fileUploader" value="Please select an excel file (*.xlsx) containing all process-ids you want to close steps in" />
												</td>
												<td>
													<h:inputFile id="fileUploader" value="#{NavigationForm.workflowPlugin.file}">
														<!--<f:validator validatorId="FileUploadValidator" />-->
													</h:inputFile>
												</td>
											</tr>
											<tr>
												<td>
													<h:commandButton value="Upload File / Check conditions" action="#{NavigationForm.workflowPlugin.uploadExcelFile}"></h:commandButton>
												</td>
												<td>
													<h5>
														Upload information
													</h5>
													<h:outputText id="uploadStatusMessage" value="#{NavigationForm.workflowPlugin.uploadStatusMessage}"/>
													<h5>
														File check information
													</h5>
													<h:outputText id="readInStatusMessage" value="#{NavigationForm.workflowPlugin.readInStatusMessage}"/>
												</td>
											</tr>
											<tr>
												<td>
													<h:commandButton value="Close steps" action="#{NavigationForm.workflowPlugin.close}"></h:commandButton>
												</td>
												<td>
													<h:commandLink action="#{NavigationForm.workflowPlugin.downloadErrorMessagesAsExcelFile}" title="#{msgs.downloadErrorsAsExcelFile}">
														<span class="btn margin-right-10 fa fa-floppy-o" />
														<h:outputText value="#{msgs.downloadErrorsAsExcelFile}" />
													</h:commandLink>
												</td>
											</tr>
											<ui:fragment rendered="#{NavigationForm.workflowPlugin.numberOfErrorMessageTitles > 0}">
												<tr>
													<td colspan="2">
														<h4>
															Click the process names to show more information:
														</h4>
													</td>
												</tr>
												<tr>
													<td colspan="2">
														<ul>
															<ui:repeat value="#{NavigationForm.workflowPlugin.errorMessageTitles}" var="process_name" varStatus="process">
																<h:commandLink action="#{NavigationForm.workflowPlugin.toggleExpandedErrorMessage}">
																	<f:param name="id" value="#{process.index}" />
																	<li>#{process_name}</li>
																</h:commandLink>
																<ui:fragment rendered="#{NavigationForm.workflowPlugin.expandedErrorMessages.get(process.index) eq 'true'}">
																	<ul>
																		<ui:repeat value="#{NavigationForm.workflowPlugin.errorMessages.get(process.index)}" var="message" varStatus="message_item">
																			<li>#{message}</li>
																		</ui:repeat>
																	</ul>
																</ui:fragment>
															</ui:repeat>
														</ul>
													</td>
												</tr>
											</ui:fragment>
										</table>
									</h:form>
								</div>
							</h:panelGroup>
						</div>
					</div>
				</div>
			</div>
		</h:panelGroup>
	</composite:implementation>
</ui:composition>